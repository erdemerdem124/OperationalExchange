@using Umbraco.Cms.Web.Common.PublishedModels;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
     
@{
    var panelHepAcik = Model.Value("panelHepAcik") is bool b && b;
    var cardId = "card-" + Model.Id;
    var isBedelsiz = (Model.Value("title") != null && Model.Value("title").ToString().Trim().ToLower() == "bedelsiz sermaye arttırımları");
    var panelWidth = Model.Value("panelGenisliI");
    if (string.IsNullOrEmpty(panelWidth?.ToString())) { panelWidth = "100%"; }
    var panelHeight = Model.Value("panelYuksekligi");
    var title = Model.Value("title")?.ToString().Trim().ToLower();
}

<div class="card-accordion" style="margin-bottom: 16px; width:@panelWidth; margin-left:auto; margin-right:auto;@(string.IsNullOrEmpty(panelHeight?.ToString()) ? "" : $" height:{panelHeight};")">
    <div
        @if (!panelHepAcik)
        {
            <text>onclick="toggleCard('@cardId')"</text>
        }
        class="card-header card-toggle @(panelHepAcik ? "open" : "")"
        data-card-id="@cardId"
        style="display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer;">
        <span style="flex:1; text-align:center;">@Model.Value("title")</span>
        @if (!panelHepAcik)
        {
            <span class="card-arrow" id="arrow-@cardId" style="margin-left:auto;">
                <svg width="24" height="24" viewBox="0 0 24 24">
                    <polygon points="6,9 12,15 18,9" style="fill:black;" />
                </svg>
            </span>
        }
    </div>
    <div id="@cardId" class="card-body" style="@(panelHepAcik ? "display:block;" : "display:none;")">
        @if (isBedelsiz)
        {
            <div style="background:#2c3e66; padding-bottom:0px;">
                <table style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr>
                            <th style="background:#22325a; color:#fff; font-family:'Segoe UI',Arial,sans-serif; font-size:1.13em; text-align:center; font-weight:500; letter-spacing:1px; padding:10px 0; border:none;">Hisse</th>
                            <th style="background:#22325a; color:#fff; font-family:'Segoe UI',Arial,sans-serif; font-size:1.13em; text-align:center; font-weight:500; letter-spacing:1px; padding:10px 0; border:none;">Lot</th>
                            <th style="background:#22325a; color:#fff; font-family:'Segoe UI',Arial,sans-serif; font-size:1.13em; text-align:center; font-weight:500; letter-spacing:1px; padding:10px 0; border:none;">İşlem</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="background:#2c3e66; border:none; color:#fff; text-align:center;">EREGL</td>
                            <td style="background:#2c3e66; border:none; color:#fff; text-align:center;">100</td>
                            <td style="text-align:center; border:none;"><button type="button" class="kucuk-kaydet-btn">Edit</button> <button type="button" class="kucuk-sil-btn" style="background: #e53935; color: #fff; border: none; border-radius: 8px; padding: 0 16px; min-width: 80px; height: 32px; font-size: 0.93em; font-weight: 500; margin-left: 6px; cursor: pointer;">Sil</button></td>
                        </tr>
                        <!-- Tek inputlu ekle satırı -->
                        <tr style="height:1px;">
                            <td style="background:#2c3e66; border:none; padding-bottom:0;"><input type="text" placeholder="Hisse" class="bedelsiz-panel-input" style="width:90%; max-width:140px; padding:6px 8px; font-size:1em; text-align:center; outline:none; margin-bottom:0;" /></td>
                            <td style="background:#2c3e66; border:none; padding-bottom:0;"><input type="number" placeholder="Lot" class="bedelsiz-panel-input" style="width:90%; max-width:140px; padding:6px 8px; font-size:1em; text-align:center; outline:none; margin-bottom:0;" /></td>
                            <td style="text-align:center; border:none; padding-bottom:0;"><button type="button" class="ekle-btn">Ekle</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        }
        else if (title == "manuel emir")
        {
            <form id="manuelBistForm">
                <div class="row mb-3 justify-content-center align-items-center" style="border-bottom:1px solid #e0e0e0; padding-bottom:16px;">
                    <div class="col-md-2 text-center">
                        <label class="form-label fw-semibold">Sembol</label>
                        <input type="text" class="form-control mx-auto" />
                    </div>
                    <div class="col-md-2 text-center">
                        <label class="form-label fw-semibold">Yön</label>
                        <input type="text" value="AL" class="form-control mx-auto" />
                    </div>
                    <div class="col-md-2 text-center">
                        <label class="form-label fw-semibold">Adet</label>
                        <input type="number" value="0" class="form-control mx-auto" />
                    </div>
                    <div class="col-md-2 text-center">
                        <label class="form-label fw-semibold">Emir Tipi</label>
                        <input type="text" value="Limit" class="form-control mx-auto" />
                    </div>
                    <div class="col-md-2 text-center">
                        <label class="form-label fw-semibold">Fiyat*</label>
                        <input type="number" value="0" class="form-control mx-auto" />
                    </div>
                </div>
                <div class="d-flex justify-content-center">
                    <button type="submit" class="btn btn-primary px-5">İLET</button>
                </div>
            </form>
        }
        else
        {
            @Html.Raw(Model.Value("content"))
                 @Html.Raw(Model.Value("content1"))
        }
    </div>
</div>

<script>
    function toggleCard(cardId) {
        var panel = document.getElementById(cardId);
        var header = document.querySelector('.card-header.card-toggle[data-card-id="' + cardId + '"]');
        if (!panel || !header) return;

        var isOpen = panel.style.display !== 'none';
        panel.style.display = isOpen ? 'none' : 'block';

        if (isOpen) {
            header.classList.remove('open');
        } else {
            header.classList.add('open');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const headers = document.querySelectorAll('.card-header.card-toggle');
        headers.forEach(function(header) {
            const cardId = header.getAttribute('data-card-id');
            const panel = document.getElementById(cardId);
            if (!panel) return;
            // Sadece panelHepAcik false ise aç/kapa class'ı uygula
            var panelHepAcik = header.classList.contains('open');
            if (!panelHepAcik) {
                if (panel.style.display !== 'none') {
                    header.classList.add('open');
                } else {
                    header.classList.remove('open');
                }
            }
        });

        // Bedelsiz formu
        var bedelsizForm = document.getElementById('bedelsizForm');
        if (bedelsizForm) {
            bedelsizForm.onsubmit = function(e) {
                e.preventDefault();
                alert('Form verisi kaydedilecek (demo).');
                return false;
            };
        }

        // Manuel Bist Emir formu
        var manuelBistForm = document.getElementById('manuelBistForm');
        if (manuelBistForm) {
            manuelBistForm.onsubmit = function(e) {
                e.preventDefault();
                alert('Form verisi kaydedilecek (demo).');
                return false;
            };
        }
    });
</script>
<style>
.card-arrow {
    transition: transform 0.2s;
    display: inline-block;
}
.card-header.open .card-arrow {
    transform: rotate(180deg) !important;
}
.card-header,
.accordion-header-custom,
.card-toggle {
    min-height: 24px;
    padding-top: 8px;
    padding-bottom: 8px;
    font-size: 1.15rem;
    box-sizing: border-box;
}
.card-header.open,
.accordion-header-custom.open,
.card-toggle.open {
    min-height: 24px;
}
.card-header:not(.open),
.accordion-header-custom:not(.open),
.card-toggle:not(.open) {
    min-height: 24px;
}
.kucuk-kaydet-btn {
    background: linear-gradient(180deg, #2c3e5c 0%, #22325a 100%);
    color: #fff;
    font-size: 0.95em;         /* Daha küçük yazı */
    font-weight: 500;
    padding: 3px 16px;         /* Daha az iç boşluk */
    border: none;
    border-radius: 10px;       /* Hafifçe küçültüldü */
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    letter-spacing: 1px;
    cursor: pointer;
    transition: background 0.2s, box-shadow 0.2s;
    margin-bottom: 6px;
}
.kucuk-kaydet-btn:hover {
    background: linear-gradient(180deg, #22325a 0%, #2c3e5c 100%);
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}
</style>
